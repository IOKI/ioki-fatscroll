angular.module("ioki.fatscroll",[]).directive("fatscroll",["$window","$document","$timeout","fatscrollsService",function(a,b,c,d){"use strict";return{restrict:"A",transclude:!0,templateUrl:"templates/ioki-fatscroll",scope:{alwaysvisible:"=",thumbheight:"=",hasrail:"=",adjustcontenttorail:"="},link:function(e,f,g){function h(){var a=d.savedPositionObject[g.fatscrollName];m(),k(),z=f[0],B=z.firstChild,C=f.find("scroll-area"),D=f.find("scroll-content")[0].clientHeight,A=f.find("scroll-area")[0].clientHeight,H=A/D,M=b.find("body"),t(),A>=D?(K.css("display","none"),j()):(K.css("display","block"),i()),a?(n(a.element,a.offset),delete d.savedPositionObject[g.fatscrollName]):n(O)}function i(){e.hasrail&&(L.css("display","block"),e.adjustcontenttorail&&C.css("width",""))}function j(){e.hasrail&&(L.css("display","none"),e.adjustcontenttorail&&C.css("width","auto"))}function k(){K.addClass("visible"),e.alwaysvisible||(J=c(l,1500))}function l(){K.removeClass("visible")}function m(){var a,b=g.fatscrollName;void 0!==b&&(a=d.getFatscrolls().filter(function(a){return a.name===b})[0],a||d.addFatscroll(b,e))}function n(a,b){var d,e,f,g,h=u();H=A/D,c.cancel(J),k(),I=parseInt(h/H,10),"string"==typeof a&&(a=parseInt(a,10)),d="number"!=typeof a?a.offsetTop:a,d="number"!=typeof b?d:d+b,e=t(),f=d*H*(D/(D-A))*(1-e/A),g=N?f>h:d>I,g?(K.css("top",h+"px"),B.scrollTop=I):0>d||0>f?(K.css("top","0"),B.scrollTop=0):(K.css("top",(N?f:d*H)+"px"),B.scrollTop=d,O=d)}function o(a){P=a.touches[0].pageY+O}function p(){O=Q}function q(a){return Q=P-a.touches[0].pageY}function r(a){a.preventDefault();var b=void 0!==a.deltaY?a.deltaY:40*a.detail;B.scrollTop+=b,n(B.scrollTop)}function s(a){a.preventDefault(),B.scrollTop=q(a),n(B.scrollTop)}function t(){var a;return a=e.thumbheight?e.thumbheight:H*A,K.css({height:a+"px"}),a}function u(){return E=t(),A-E}function v(a){n(a.layerY*((D-A)/A))}function w(a){document.onselectstart=function(){return!1},F=a.pageY,G=B.scrollTop,b.on("mousemove",y),b.on("mouseup",x)}function x(){document.onselectstart=function(){return!0},b.off("mousemove",y),M.removeClass("no-select")}function y(a){E=t(),M.addClass("no-select"),n(N?G+(a.pageY-F)/(u()/(D-A)):G+(a.pageY-F)/H)}var z,A,B,C,D,E,F,G,H,I,J,K=f.find("thumb"),L=f.find("rail"),M=b.find("body"),N=e.thumbheight?!0:!1,O=0,P=0,Q=0;e.scrollContentHeight=f.find("scroll-content")[0],f.on("mousewheel",r),f.on("DOMMouseScroll",r),f.on("wheel",r),f.on("touchstart",o),f.on("touchmove",s),f.on("touchend",p),K.on("mousedown touchstart",w),L.on("click",v),g.fatscrollDynamic?(c(function(){h()},0),angular.element(a).on("resize",function(){h()})):h(),e.$watch("scrollContentHeight.clientHeight",function(a,b){a!==b&&h()}),e.scrollTo=n}}}]),angular.module("ioki.fatscroll").factory("fatscrollsService",function(){"use strict";var a={fatscrolls:[],savedPositionObject:{},getFatscrolls:function(){return a.fatscrolls},getFatscroll:function(b){for(var c=0,d=a.fatscrolls.length;d>c;c++)if(a.fatscrolls[c].name===b)return a.fatscrolls[c].scope;return null},addFatscroll:function(b,c){void 0!==b&&void 0!==c&&a.fatscrolls.push({name:b,scope:c})},moveMeTo:function(b,c,d){var e=a.getFatscroll(b);null!==e&&e.scrollTo(c,d)},moveMeToOnInit:function(a,b,c){this.savedPositionObject[a]={element:b,offset:c||0}}};return a}),angular.module("ioki.fatscroll").run(["$templateCache",function(a){"use strict";a.put("templates/ioki-fatscroll",'<scroll-area>\n    <scroll-content class="scroll-content" ng-transclude></scroll-content>\n</scroll-area>\n<rail ng-show="hasrail"></rail>\n<thumb></thumb>')}]);