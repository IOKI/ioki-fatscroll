angular.module("ioki.fatscroll",[]).directive("fatscroll",["$document","$timeout","fatscrollsService",function(a,b,c){"use strict";return{restrict:"A",transclude:!0,templateUrl:"templates/ioki-fatscroll",scope:{},link:function(d,e,f){function g(){j(),h(),r=e[0],s=e[0].clientHeight,t=r.firstChild,u=e.find("scroll-area"),v=e.find("scroll-content")[0].clientHeight,A=s/v,F=a.find("body"),m(),u.css("height",s+"px"),s>=v?E.css("display","none"):E.css("display","block")}function h(){E.addClass("visible"),D=b(i,1500)}function i(){E.removeClass("visible")}function j(){var a=f.fatscrollName;void 0!==a&&c.addFatscroll(a,d)}function k(a,c){var d,e=n();b.cancel(D),h(),C=parseInt(e/A,10),a=parseInt(a,10),d="number"!=typeof a?a.offsetTop:a,d="number"!=typeof c?d:d+c,d>C?(E.css("top",e+"px"),G=e,t.scrollTop=C):0>d?(E.css("top","0"),G=0,t.scrollTop=0):(E.css("top",+(d*A)+"px"),G=d*A,t.scrollTop=d)}function l(a){var b=void 0!==a.deltaY?a.deltaY:40*a.detail;t.scrollTop+=b,k(t.scrollTop)}function m(){var a=A*s;return E.css({height:a+"px"}),a}function n(){return w=m(),s-w}function o(b){y=b.y||b.clientY,x=parseInt(E.css("top")||0,10),z=t.scrollTop,a.on("mousemove",q),a.on("mouseup",p)}function p(){a.off("mousemove",q),F.removeClass("no-select")}function q(a){B=x+a.pageY-y,w=m(),F.addClass("no-select"),k(z+(a.pageY-y)/A)}var r,s,t,u,v,w,x,y,z,A,B,C,D,E=e.find("thumb"),F=a.find("body"),G=0;d.scrollContentHeight=e.find("scroll-content")[0],e.on("mousewheel",l),e.on("DOMMouseScroll",l),E.on("mousedown touchstart",o),g(),d.$watch("scrollContentHeight.clientHeight",function(a,b){a!==b&&g()}),d.scrollTo=k}}}]),angular.module("ioki.fatscroll").factory("fatscrollsService",function(){"use strict";var a={fatscrolls:[],getFatscrolls:function(){return a.fatscrolls},getFatscroll:function(b){for(var c=0,d=a.fatscrolls.length;d>c;c++)if(a.fatscrolls[c].name===b)return a.fatscrolls[c].scope;return null},addFatscroll:function(b,c){void 0!==b&&void 0!==c&&a.fatscrolls.push({name:b,scope:c})},moveMeTo:function(b,c,d){var e=a.getFatscroll(b);null!==e&&e.scrollTo(c,d)}};return a}),angular.module("ioki.fatscroll").run(["$templateCache",function(a){"use strict";a.put("templates/ioki-fatscroll",'<scroll-area>\n    <scroll-content class="scroll-content" ng-transclude></scroll-content>\n</scroll-area>\n<thumb></thumb>')}]);