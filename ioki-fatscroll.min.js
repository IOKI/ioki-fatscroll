angular.module("ioki.fatscroll",[]).directive("fatscroll",["$window","$document","$timeout","fatscrollsService",function(a,b,c,d){"use strict";return{restrict:"A",transclude:!0,templateUrl:"templates/ioki-fatscroll",scope:{},link:function(e,f,g){function h(){k(),i(),s=f[0],t=f[0].clientHeight,u=s.firstChild,v=f.find("scroll-area"),w=f.find("scroll-content")[0].clientHeight,B=t/w,G=b.find("body"),n(),v.css("height",t+"px"),t>=w?F.css("display","none"):F.css("display","block")}function i(){F.addClass("visible"),E=c(j,1500)}function j(){F.removeClass("visible")}function k(){var a=g.fatscrollName;void 0!==a&&d.addFatscroll(a,e)}function l(a,b){var d,e=o();c.cancel(E),i(),D=parseInt(e/B,10),"string"==typeof a&&(a=parseInt(a,10)),d="number"!=typeof a?a.offsetTop:a,d="number"!=typeof b?d:d+b,d>D?(F.css("top",e+"px"),H=e,u.scrollTop=D):0>d?(F.css("top","0"),H=0,u.scrollTop=0):(F.css("top",+(d*B)+"px"),H=d*B,u.scrollTop=d)}function m(a){a.preventDefault();var b=void 0!==a.deltaY?a.deltaY:40*a.detail;u.scrollTop+=b,l(u.scrollTop)}function n(){var a=B*t;return F.css({height:a+"px"}),a}function o(){return x=n(),t-x}function p(a){z=a.y||a.clientY,y=parseInt(F.css("top")||0,10),A=u.scrollTop,b.on("mousemove",r),b.on("mouseup",q)}function q(){b.off("mousemove",r),G.removeClass("no-select")}function r(a){C=y+a.pageY-z,x=n(),G.addClass("no-select"),l(A+(a.pageY-z)/B)}var s,t,u,v,w,x,y,z,A,B,C,D,E,F=f.find("thumb"),G=b.find("body"),H=0;e.scrollContentHeight=f.find("scroll-content")[0],f.on("mousewheel",m),f.on("DOMMouseScroll",m),F.on("mousedown touchstart",p),g.fatscrollDynamic?(c(function(){h()},0),angular.element(a).on("resize",function(){h()})):h(),e.$watch("scrollContentHeight.clientHeight",function(a,b){a!==b&&h()}),e.scrollTo=l}}}]),angular.module("ioki.fatscroll").factory("fatscrollsService",function(){"use strict";var a={fatscrolls:[],getFatscrolls:function(){return a.fatscrolls},getFatscroll:function(b){for(var c=0,d=a.fatscrolls.length;d>c;c++)if(a.fatscrolls[c].name===b)return a.fatscrolls[c].scope;return null},addFatscroll:function(b,c){void 0!==b&&void 0!==c&&a.fatscrolls.push({name:b,scope:c})},moveMeTo:function(b,c,d){var e=a.getFatscroll(b);null!==e&&e.scrollTo(c,d)}};return a}),angular.module("ioki.fatscroll").run(["$templateCache",function(a){"use strict";a.put("templates/ioki-fatscroll",'<scroll-area>\n    <scroll-content class="scroll-content" ng-transclude></scroll-content>\n</scroll-area>\n<thumb></thumb>')}]);