angular.module("ioki.fatscroll",[]).directive("fatscroll",["$window","$document","$timeout","fatscrollsService",function(a,b,c,d){"use strict";return{restrict:"A",transclude:!0,templateUrl:"templates/ioki-fatscroll",scope:{alwaysvisible:"=",thumbheight:"=",hasrail:"=",adjustcontenttorail:"="},link:function(e,f,g){function h(){m(),k(),v=f[0],x=v.firstChild,y=f.find("scroll-area"),z=f.find("scroll-content")[0].clientHeight,w=f.find("scroll-area")[0].clientHeight,D=w/z,I=b.find("body"),p(),w>=z?(G.css("display","none"),j()):(G.css("display","block"),i()),n(x.scrollTop)}function i(){e.hasrail&&(H.css("display","block"),e.adjustcontenttorail&&y.css("width",""))}function j(){e.hasrail&&(H.css("display","none"),e.adjustcontenttorail&&y.css("width","auto"))}function k(){G.addClass("visible"),e.alwaysvisible||(E=c(l,1500))}function l(){G.removeClass("visible")}function m(){var a=g.fatscrollName;void 0!==a&&d.addFatscroll(a,e)}function n(a,b){var d,e,f,g,h=q();c.cancel(E),k(),F=parseInt(h/D,10),"string"==typeof a&&(a=parseInt(a,10)),d="number"!=typeof a?a.offsetTop:a,d="number"!=typeof b?d:d+b,e=p(),f=d*D*(z/(z-w))*(1-e/w),g=J?f>h:d>F,g?(G.css("top",h+"px"),x.scrollTop=F):0>d||0>f?(G.css("top","0"),x.scrollTop=0):(G.css("top",+(J?f:d*D)+"px"),x.scrollTop=d)}function o(a){a.preventDefault();var b=void 0!==a.deltaY?a.deltaY:40*a.detail;x.scrollTop+=b,n(x.scrollTop)}function p(){var a;return a=e.thumbheight?e.thumbheight:D*w,G.css({height:a+"px"}),a}function q(){return A=p(),w-A}function r(a){n(a.layerY*((z-w)/w))}function s(a){document.onselectstart=function(){return!1},B=a.pageY,C=x.scrollTop,b.on("mousemove",u),b.on("mouseup",t)}function t(){document.onselectstart=function(){return!0},b.off("mousemove",u),I.removeClass("no-select")}function u(a){A=p(),I.addClass("no-select"),n(J?C+(a.pageY-B)/(q()/(z-w)):C+(a.pageY-B)/D)}var v,w,x,y,z,A,B,C,D,E,F,G=f.find("thumb"),H=f.find("rail"),I=b.find("body"),J=e.thumbheight?!0:!1;e.scrollContentHeight=f.find("scroll-content")[0],f.on("mousewheel",o),f.on("DOMMouseScroll",o),f.on("wheel",o),G.on("mousedown touchstart",s),H.on("click",r),g.fatscrollDynamic?(c(function(){h()},0),angular.element(a).on("resize",function(){h()})):h(),e.$watch("scrollContentHeight.clientHeight",function(a,b){a!==b&&h()}),e.scrollTo=n}}}]),angular.module("ioki.fatscroll").factory("fatscrollsService",function(){"use strict";var a={fatscrolls:[],getFatscrolls:function(){return a.fatscrolls},getFatscroll:function(b){for(var c=0,d=a.fatscrolls.length;d>c;c++)if(a.fatscrolls[c].name===b)return a.fatscrolls[c].scope;return null},addFatscroll:function(b,c){void 0!==b&&void 0!==c&&a.fatscrolls.push({name:b,scope:c})},moveMeTo:function(b,c,d){var e=a.getFatscroll(b);null!==e&&setTimeout(function(){e.scrollTo(c,d)},350)}};return a}),angular.module("ioki.fatscroll").run(["$templateCache",function(a){"use strict";a.put("templates/ioki-fatscroll",'<scroll-area>\n    <scroll-content class="scroll-content" ng-transclude></scroll-content>\n</scroll-area>\n<rail ng-show="hasrail"></rail>\n<thumb></thumb>')}]);