angular.module("ioki.fatscroll",[]).directive("fatscroll",["$window","$document","$timeout","$interval","fatscrollsService",function(a,b,c,d,e){"use strict";return{restrict:"A",transclude:!0,templateUrl:"templates/ioki-fatscroll",scope:{alwaysvisible:"=",thumbheight:"=",hasrail:"=",adjustcontenttorail:"="},link:function(a,f,g){function h(a){var c=e.savedPositionObject[g.fatscrollName];a=a||0,m(),k(),z=f[0],B=z.firstChild,C=f.find("scroll-area"),D=f.find("scroll-content")[0].clientHeight,A=f.find("scroll-area")[0].clientHeight,I=A/D,L=b.find("body"),t(),A>=D?(M.css("display","none"),j()):(M.css("display","block"),i()),c?(n(c.element,c.offset),delete e.savedPositionObject[g.fatscrollName]):n(a)}function i(){a.hasrail&&(N.css("display","block"),a.adjustcontenttorail&&C.css("width",""))}function j(){a.hasrail&&(N.css("display","none"),a.adjustcontenttorail&&C.css("width","auto"))}function k(){M.addClass("visible"),a.alwaysvisible||(J=c(l,1500))}function l(){M.removeClass("visible")}function m(){var b,c=g.fatscrollName;void 0!==c&&(b=e.getFatscrolls().filter(function(a){return a.name===c})[0],b||e.addFatscroll(c,a))}function n(a,b){var d,e,f,g,h,i=u();I=A/D,c.cancel(J),k(),d=parseInt(i/I,10),"string"==typeof a&&(a=parseInt(a,10)),e="number"!=typeof a?a.offsetTop:a,e="number"!=typeof b?e:e+b,F=e,f=t(),g=e*I*(D/(D-A))*(1-f/A),h=R?g>i:e>d,h?(M.css("top",i+"px"),B.scrollTop=d):0>e||0>g?(M.css("top","0"),B.scrollTop=0):(M.css("top",(R?g:e*I)+"px"),B.scrollTop=e,Q=e)}function o(a){O=a.touches[0].pageY+Q}function p(){Q=P}function q(a){return P=O-a.touches[0].pageY}function r(a){a.preventDefault();var b=void 0!==a.deltaY?a.deltaY:40*a.detail;B.scrollTop+=b,n(B.scrollTop)}function s(a){a.preventDefault(),B.scrollTop=q(a),n(B.scrollTop)}function t(){var b;return b=a.thumbheight?a.thumbheight:I*A,M.css({height:b+"px"}),b}function u(){return E=t(),A-E}function v(a){n(a.layerY*((D-A)/A))}function w(a){document.onselectstart=function(){return!1},G=a.pageY,H=B.scrollTop,b.on("mousemove",y),b.on("mouseup",x)}function x(){document.onselectstart=function(){return!0},b.off("mousemove",y),b.off("mouseup",x),L.removeClass("no-select")}function y(a){E=t(),L.addClass("no-select"),n(R?H+(a.pageY-G)/(u()/(D-A)):H+(a.pageY-G)/I)}var z,A,B,C,D,E,F,G,H,I,J,K,L=b.find("body"),M=f.find("thumb"),N=f.find("rail"),O=0,P=0,Q=0,R=a.thumbheight?!0:!1;f.on("mousewheel",r),f.on("DOMMouseScroll",r),f.on("wheel",r),f.on("touchstart",o),f.on("touchmove",s),f.on("touchend",p),M.on("mousedown touchstart",w),N.on("click",v),g.fatscrollDynamic?K=d(function(){D!==f.find("scroll-content")[0].clientHeight&&h(F)},100):h(),a.$on("$destroy",function(){e.removeFatscroll(g.fatscrollName),d.cancel(K),f.off("mousewheel",r),f.off("DOMMouseScroll",r),f.off("wheel",r),f.off("touchstart",o),f.off("touchmove",s),f.off("touchend",p),M.off("mousedown touchstart",w),N.off("click",v)}),a.scrollTo=n}}}]),angular.module("ioki.fatscroll").factory("fatscrollsService",function(){"use strict";var a={fatscrolls:[],savedPositionObject:{},getFatscrolls:function(){return a.fatscrolls},getFatscroll:function(b){for(var c=0,d=a.fatscrolls.length;d>c;c++)if(a.fatscrolls[c].name===b)return a.fatscrolls[c];return null},addFatscroll:function(b,c){void 0!==b&&void 0!==c&&a.fatscrolls.push({name:b,scope:c})},removeFatscroll:function(b){var c=a.getFatscroll(b),d=a.getFatscrolls(),e=d.indexOf(c);e>-1&&d.splice(e,1)},getFatscrollScope:function(b){var c=a.getFatscroll(b);return c.scope?c.scope:null},moveMeTo:function(b,c,d){var e=a.getFatscrollScope(b);null!==e&&e.scrollTo(c,d)},moveMeToOnInit:function(a,b,c){this.savedPositionObject[a]={element:b,offset:c||0}}};return a}),angular.module("ioki.fatscroll").run(["$templateCache",function(a){"use strict";a.put("templates/ioki-fatscroll",'<scroll-area>\n    <scroll-content class="scroll-content" ng-transclude></scroll-content>\n</scroll-area>\n<rail ng-show="hasrail"></rail>\n<thumb></thumb>')}]);