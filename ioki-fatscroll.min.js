angular.module("ioki.fatscroll",[]).directive("fatscroll",["$window","$document","$timeout","fatscrollsService",function(a,b,c,d){"use strict";var e;return{restrict:"A",transclude:!0,templateUrl:"templates/ioki-fatscroll",scope:{alwaysvisible:"=",thumbheight:"=",hasrail:"=",adjustcontenttorail:"="},link:function(f,g,h){function i(){n(),l(),B=g[0],D=B.firstChild,E=g.find("scroll-area"),F=g.find("scroll-content")[0].clientHeight,C=g.find("scroll-area")[0].clientHeight,J=C/F,O=b.find("body"),v(),C>=F?(M.css("display","none"),k()):(M.css("display","block"),j()),e?(p(e),e=null):p(Q)}function j(){f.hasrail&&(N.css("display","block"),f.adjustcontenttorail&&E.css("width",""))}function k(){f.hasrail&&(N.css("display","none"),f.adjustcontenttorail&&E.css("width","auto"))}function l(){M.addClass("visible"),f.alwaysvisible||(L=c(m,1500))}function m(){M.removeClass("visible")}function n(){var a,b=h.fatscrollName;void 0!==b&&(a=d.getFatscrolls().filter(function(a){return a.name===b})[0],a||d.addFatscroll(b,f))}function o(a){e=a}function p(a,b){var d,e,f,g,h=w();J=C/F,c.cancel(L),l(),K=parseInt(h/J,10),"string"==typeof a&&(a=parseInt(a,10)),d="number"!=typeof a?a.offsetTop:a,d="number"!=typeof b?d:d+b,e=v(),f=d*J*(F/(F-C))*(1-e/C),g=P?f>h:d>K,g?(M.css("top",h+"px"),D.scrollTop=K):0>d||0>f?(M.css("top","0"),D.scrollTop=0):(M.css("top",(P?f:d*J)+"px"),D.scrollTop=d,Q=d)}function q(a){R=a.touches[0].pageY+Q}function r(){Q=S}function s(a){return S=R-a.touches[0].pageY}function t(a){a.preventDefault();var b=void 0!==a.deltaY?a.deltaY:40*a.detail;D.scrollTop+=b,p(D.scrollTop)}function u(a){a.preventDefault(),D.scrollTop=s(a),p(D.scrollTop)}function v(){var a;return a=f.thumbheight?f.thumbheight:J*C,M.css({height:a+"px"}),a}function w(){return G=v(),C-G}function x(a){p(a.layerY*((F-C)/C))}function y(a){document.onselectstart=function(){return!1},H=a.pageY,I=D.scrollTop,b.on("mousemove",A),b.on("mouseup",z)}function z(){document.onselectstart=function(){return!0},b.off("mousemove",A),O.removeClass("no-select")}function A(a){G=v(),O.addClass("no-select"),p(P?I+(a.pageY-H)/(w()/(F-C)):I+(a.pageY-H)/J)}var B,C,D,E,F,G,H,I,J,K,L,M=g.find("thumb"),N=g.find("rail"),O=b.find("body"),P=f.thumbheight?!0:!1,Q=0,R=0,S=0;f.scrollContentHeight=g.find("scroll-content")[0],g.on("mousewheel",t),g.on("DOMMouseScroll",t),g.on("wheel",t),g.on("touchstart",q),g.on("touchmove",u),g.on("touchend",r),M.on("mousedown touchstart",y),N.on("click",x),h.fatscrollDynamic?(c(function(){i()},0),angular.element(a).on("resize",function(){i()})):i(),f.$watch("scrollContentHeight.clientHeight",function(a,b){a!==b&&i()}),f.scrollTo=p,f.setClickedElement=o}}}]),angular.module("ioki.fatscroll").factory("fatscrollsService",function(){"use strict";var a={fatscrolls:[],getFatscrolls:function(){return a.fatscrolls},getFatscroll:function(b){for(var c=0,d=a.fatscrolls.length;d>c;c++)if(a.fatscrolls[c].name===b)return a.fatscrolls[c].scope;return null},addFatscroll:function(b,c){void 0!==b&&void 0!==c&&a.fatscrolls.push({name:b,scope:c})},moveMeTo:function(b,c,d){var e=a.getFatscroll(b);null!==e&&e.scrollTo(c,d)},moveMeToWithInit:function(b,c){var d=a.getFatscroll(b);d.setClickedElement(c)}};return a}),angular.module("ioki.fatscroll").run(["$templateCache",function(a){"use strict";a.put("templates/ioki-fatscroll",'<scroll-area>\n    <scroll-content class="scroll-content" ng-transclude></scroll-content>\n</scroll-area>\n<rail ng-show="hasrail"></rail>\n<thumb></thumb>')}]);